--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

--// Variablen
local auraEnabled = true
local auraRange = 25
local attackOffset = Vector3.new(0, 3, -3)

--// UI
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "AuraUI"

local rangeBox = Instance.new("TextBox", gui)
rangeBox.Size = UDim2.new(0, 200, 0, 30)
rangeBox.Position = UDim2.new(0, 50, 0, 100)
rangeBox.PlaceholderText = "Aura Range (z. B. 25)"
rangeBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
rangeBox.TextColor3 = Color3.new(1, 1, 1)
rangeBox.Text = ""

--// Aura Visual
local auraVisual = Instance.new("Part")
auraVisual.Shape = Enum.PartType.Ball
auraVisual.Anchored = true
auraVisual.CanCollide = false
auraVisual.Transparency = 0.6
auraVisual.Color = Color3.fromRGB(255, 0, 0)
auraVisual.Material = Enum.Material.ForceField
auraVisual.Name = "KillAuraVisual"
auraVisual.Parent = workspace
auraVisual.Size = Vector3.new(auraRange * 2, auraRange * 2, auraRange * 2)

--// Update Funktion
local function updateAuraSize(newRange)
    auraRange = newRange
    auraVisual.Size = Vector3.new(auraRange * 2, auraRange * 2, auraRange * 2)
end

rangeBox.FocusLost:Connect(function()
    local val = tonumber(rangeBox.Text)
    if val and val > 0 then
        updateAuraSize(val)
    end
end)

--// Aura Loop
RunService.Heartbeat:Connect(function()
    local char = LocalPlayer.Character
    if not auraEnabled or not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local myHRP = char.HumanoidRootPart

    auraVisual.Position = myHRP.Position

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local enemyChar = player.Character
            local enemyHRP = enemyChar:FindFirstChild("HumanoidRootPart")
            local hit = false

            -- Check auf alle Körperteile im Radius
            for _, part in ipairs(enemyChar:GetChildren()) do
                if part:IsA("BasePart") then
                    local distance = (part.Position - myHRP.Position).Magnitude
                    if distance <= auraRange then
                        hit = true
                        break
                    end
                end
            end

            -- Wenn getroffen, teleportieren und hitten
            if hit then
                enemyHRP.CFrame = myHRP.CFrame * CFrame.new(attackOffset)
                ReplicatedStorage.rEvents.hitRemote:FireServer(enemyChar)
            end
        end
    end
end)
